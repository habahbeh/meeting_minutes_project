<!-- templates/meetings/meeting_detail.html -->
{% extends 'base.html' %}

{% block title %}{{ meeting.title }}{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <!-- Header -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h2>{{ meeting.title }}</h2>
                <p class="text-muted mb-0">
                    <i class="bi bi-calendar"></i> {{ meeting.created_at|date:"d M Y - H:i" }}
                </p>
            </div>
            <div>
                {% if meeting.is_processed %}
                    <span class="badge bg-success fs-6">مكتمل</span>
                {% else %}
                    <span class="badge bg-secondary fs-6">غير معالج</span>
                {% endif %}
            </div>
        </div>

        {% if meeting.is_processed %}
            <!-- Minutes -->
            {% if meeting.minutes %}
                <div class="content-section">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5 class="text-success mb-0">
                            <i class="bi bi-file-earmark-text"></i> محضر الاجتماع
                        </h5>
                        <button class="btn btn-outline-primary btn-sm" onclick="copyToClipboard('minutes')">
                            <i class="bi bi-clipboard"></i> نسخ
                        </button>
                    </div>
                    <div style="white-space: pre-line; line-height: 1.8;">{{ meeting.minutes }}</div>
                </div>
            {% endif %}

            <!-- Summary -->
            {% if meeting.summary %}
                <div class="content-section">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5 class="text-info mb-0">
                            <i class="bi bi-file-text"></i> التلخيص
                        </h5>
                        <button class="btn btn-outline-primary btn-sm" onclick="copyToClipboard('summary')">
                            <i class="bi bi-clipboard"></i> نسخ
                        </button>
                    </div>
                    <div style="white-space: pre-line; line-height: 1.8;">{{ meeting.summary }}</div>
                </div>
            {% endif %}

            <!-- Transcript -->
            {% if meeting.transcript %}
                <div class="content-section">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5 class="mb-0">
                            <i class="bi bi-chat-text"></i> النص المحول
                        </h5>
                        <button class="btn btn-outline-primary btn-sm" onclick="copyToClipboard('transcript')">
                            <i class="bi bi-clipboard"></i> نسخ
                        </button>
                    </div>
                    <div style="white-space: pre-line; line-height: 1.8; max-height: 400px; overflow-y: auto; border: 1px solid #dee2e6; padding: 1rem; border-radius: 4px; background-color: #f8f9fa;">
                        {{ meeting.transcript }}
                    </div>
                </div>
            {% endif %}
        {% else %}
            <!-- Not Processed -->
            <div class="content-section text-center">
                <i class="bi bi-hourglass-split display-4 text-muted"></i>
                <h4 class="mt-3 text-muted">لم تتم معالجة الملف بعد</h4>
                <p class="text-muted">قم برفع الملف ومعالجته للحصول على النتائج</p>
                <a href="{% url 'upload_meeting' %}" class="btn btn-primary">
                    <i class="bi bi-upload"></i> رفع ملف جديد
                </a>
            </div>
        {% endif %}

        <!-- Audio File Info -->
        <div class="content-section">
            <h5 class="mb-3"><i class="bi bi-file-earmark-music"></i> معلومات الملف</h5>
            <div class="row">
                <div class="col-md-6">
                    <p><strong>اسم الملف:</strong> {{ meeting.audio_file.name|cut:"audio/" }}</p>
                    <p><strong>حجم الملف:</strong> {{ meeting.audio_file.size|filesizeformat }}</p>
                </div>
                <div class="col-md-6">
                    {% if meeting.audio_file %}
                        <audio controls class="w-100">
                            <source src="{{ meeting.audio_file.url }}" type="audio/mpeg">
                            متصفحك لا يدعم تشغيل الملفات الصوتية.
                        </audio>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="d-flex gap-2 mt-4">
            <a href="{% url 'meeting_list' %}" class="btn btn-outline-primary">
                <i class="bi bi-arrow-right"></i> العودة للقائمة
            </a>
            <a href="{% url 'delete_meeting' meeting.pk %}" class="btn btn-outline-danger">
                <i class="bi bi-trash"></i> حذف الاجتماع
            </a>
        </div>
    </div>
</div>

<!-- Hidden elements for copying -->
<textarea id="minutes-text" style="position: absolute; left: -9999px;">{{ meeting.minutes }}</textarea>
<textarea id="summary-text" style="position: absolute; left: -9999px;">{{ meeting.summary }}</textarea>
<textarea id="transcript-text" style="position: absolute; left: -9999px;">{{ meeting.transcript }}</textarea>
{% endblock %}

{% block extra_js %}
<script>
// وظيفة نسخ النص
function copyToClipboard(type) {
    const textArea = document.getElementById(type + '-text');
    textArea.select();
    textArea.setSelectionRange(0, 99999);
    document.execCommand('copy');

    // إظهار رسالة نجاح
    const toast = document.createElement('div');
    toast.className = 'alert alert-success position-fixed';
    toast.style.top = '20px';
    toast.style.left = '50%';
    toast.style.transform = 'translateX(-50%)';
    toast.style.zIndex = '9999';
    toast.innerHTML = '<i class="bi bi-check-circle"></i> تم نسخ النص بنجاح';
    document.body.appendChild(toast);

    setTimeout(() => {
        document.body.removeChild(toast);
    }, 2000);
}
</script>
{% endblock %}